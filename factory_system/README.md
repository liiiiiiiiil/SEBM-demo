# 工厂销售和生产流程系统

一个完整的工厂销售和生产流程管理系统，基于Django框架开发。

## 功能特性

### 核心流程

1. **销售下单与审批**
   - 销售员创建订单
   - 销售经理审批订单
   - 系统自动预占库存（可选）

2. **智能库存研判**
   - 自动检查成品库存
   - 库存充足：锁定库存，生成发货通知单
   - 库存不足：计算缺口，生成生产任务单

3. **生产闭环**
   - 生产任务接收
   - BOM配方解析，自动计算所需原料
   - 原料领用（自动检查原料库存）
   - 生产执行
   - 质检记录
   - 成品入库

4. **物流发货**
   - 创建发货单
   - 分配司机和车辆
   - 确认发货，扣减库存

### 角色权限

- **销售员**：创建订单，查看自己的订单状态
- **销售经理**：审批订单，查看销售报表
- **仓库管理员**：查看库存，审核领料单，确认入库
- **生产管理员**：接收生产任务，发起领料申请
- **质检员**：录入质检记录
- **物流管理员**：管理发货，维护司机车辆信息
- **总经理**：数据驾驶舱，查看所有数据

## 安装和运行

### 1. 安装依赖

```bash
pip install django
# 如果使用PostgreSQL
pip install psycopg2
```

### 2. 配置数据库

编辑 `factory_system/settings.py`：

- **SQLite（开发环境）**：默认配置，无需修改
- **PostgreSQL（生产环境）**：取消注释PostgreSQL配置，填写数据库信息

### 3. 创建数据库表

```bash
cd factory_system
python manage.py makemigrations
python manage.py migrate
```

### 4. 创建超级用户

```bash
python manage.py createsuperuser
```

### 5. 初始化数据

在Django管理后台或使用Django shell创建：
- 客户信息
- 产品信息
- BOM配方
- 原料信息
- 用户角色

### 6. 运行开发服务器

```bash
python manage.py runserver
```

访问 http://127.0.0.1:8000/

## 使用说明

### 1. 登录系统

使用创建的用户账号登录系统。

### 2. 创建基础数据

在管理后台（/admin/）创建：
- **客户**：客户名称、联系人、地址、信用等级
- **产品**：成品SKU、名称、规格、售价、安全库存
- **原料**：原料SKU、名称、单位、单价、安全库存
- **BOM配方**：定义成品与原料的配比关系
- **司机和车辆**：物流资源信息

### 3. 业务流程

#### 销售流程
1. 销售员创建订单
2. 销售经理审批订单
3. 系统自动检查库存并创建生产任务或发货通知单

#### 生产流程
1. 生产管理员接收生产任务
2. 系统根据BOM自动创建领料单
3. 仓库管理员审核领料单，扣减原料库存
4. 生产完成后，质检员录入质检记录
5. 仓库管理员确认成品入库

#### 物流流程
1. 系统生成发货通知单
2. 物流管理员创建发货单，分配司机和车辆
3. 确认发货，系统自动扣减成品库存

## 项目结构

```
factory_system/
├── accounts/          # 用户认证和角色管理
├── inventory/         # 库存管理模块
├── sales/            # 销售模块
├── production/        # 生产管理模块
├── logistics/        # 物流管理模块
├── templates/        # 模板文件
└── factory_system/   # 项目配置
```

## 技术栈

- **后端框架**：Django 5.2
- **数据库**：SQLite（开发）/ PostgreSQL（生产）
- **前端**：Bootstrap 5
- **权限控制**：基于角色的访问控制（RBAC）

## 注意事项

1. 生产环境请使用PostgreSQL数据库
2. 修改SECRET_KEY为安全的随机字符串
3. 设置DEBUG=False并配置ALLOWED_HOSTS
4. 配置静态文件和媒体文件服务
5. 定期备份数据库

## 许可证

MIT License

